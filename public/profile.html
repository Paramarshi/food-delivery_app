<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Grocery Mart</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <!-- Google Fonts: Inter -->   
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Clerk Authentication - Local Script -->
    <script src="./clerk.browser.js"></script>

    <style>
        /* Define CSS variables for theming */
        :root {
            --bg-light: #f7fee7; /* lime-50 */
            --text-light: #1a2e05; /* dark green */
            --card-bg-light: #ffffff;
            --border-light: #dcfce7; /* green-100 */
            --subtle-text-light: #4d5e42; /* darker green-gray for better contrast */
            --accent-color-1: #84cc16; /* lime-500 */
            --accent-color-2: #a3e635; /* lime-400 */

            /* Enhanced dark mode colors with better depth */
            --bg-dark: #0f172a; /* slate-900 - richer dark background */
            --bg-dark-secondary: #1e293b; /* slate-800 - for layered depth */
            --text-dark: #ecfccb; /* lime-100 */
            --card-bg-dark: #1e293b; /* slate-800 */
            --card-bg-dark-elevated: #334155; /* slate-700 - for elevated cards */
            --border-dark: #334155; /* slate-700 */
            --subtle-text-dark: #94a3b8; /* slate-400 */

            /* Background pattern variables */
            --bg-image-light: url('https://www.transparenttextures.com/patterns/cubes.png');
            --bg-image-dark: url('https://www.transparenttextures.com/patterns/dark-matter.png');
            
            /* Glassmorphism background variables with enhanced blur */
            --glass-bg-light: rgba(255, 255, 255, 0.85);
            --glass-bg-dark: rgba(30, 41, 59, 0.75);
            
            /* Transition timing - optimized for smoothness */
            --theme-transition-duration: 0.5s;
            --theme-transition-easing: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Apply light theme by default with smooth transitions */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            background-image: var(--bg-image-light);
            background-size: cover;
            background-attachment: fixed;
            transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
                        color var(--theme-transition-duration) var(--theme-transition-easing),
                        background-image var(--theme-transition-duration) var(--theme-transition-easing);
        }

        /* Enhanced dark mode with gradient overlay */
        html.dark body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            background-size: 200% 200%;
            background-attachment: fixed;
            color: var(--text-dark);
            background-image: var(--bg-image-dark);
            animation: gradientShift 15s ease infinite;
        }

        /* Subtle gradient animation for dark mode */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Utility classes with smooth transitions */
        .themed-bg {
            background-color: var(--card-bg-light);
            transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
                        box-shadow var(--theme-transition-duration) var(--theme-transition-easing);
        }
        html.dark .themed-bg {
            background-color: var(--card-bg-dark);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
        }
        
        .themed-text {
            color: var(--text-light);
            transition: color var(--theme-transition-duration) var(--theme-transition-easing);
        }
        html.dark .themed-text {
            color: var(--text-dark);
        }
        
        .themed-subtle-text {
            color: var(--subtle-text-light);
            transition: color var(--theme-transition-duration) var(--theme-transition-easing);
        }
        html.dark .themed-subtle-text {
            color: var(--subtle-text-dark);
        }
        
        .themed-border {
            border-color: var(--border-light);
            transition: border-color var(--theme-transition-duration) var(--theme-transition-easing);
        }
        html.dark .themed-border {
            border-color: var(--border-dark);
        }
        
        .themed-card-bg {
            background-color: var(--card-bg-light);
            transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
                        box-shadow var(--theme-transition-duration) var(--theme-transition-easing),
                        transform var(--theme-transition-duration) var(--theme-transition-easing);
        }
        html.dark .themed-card-bg {
            background-color: var(--card-bg-dark);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
        }
        html.dark .themed-card-bg:hover {
            background-color: var(--card-bg-dark-elevated);
            transform: translateY(-2px);
        }

        /* Enhanced glass effect with better blur and depth */
        .glass-effect {
            background-color: var(--glass-bg-light);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            backdrop-filter: blur(16px) saturate(180%);
            border-color: rgba(255, 255, 255, 0.5);
            transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
                        border-color var(--theme-transition-duration) var(--theme-transition-easing),
                        backdrop-filter var(--theme-transition-duration) var(--theme-transition-easing),
                        box-shadow var(--theme-transition-duration) var(--theme-transition-easing);
        }
        html.dark .glass-effect {
            background-color: var(--glass-bg-dark);
            border-color: rgba(71, 85, 105, 0.6);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            backdrop-filter: blur(20px) saturate(180%);
        }

        /* Button styles with smooth transitions */
        .btn-primary {
            background-image: linear-gradient(45deg, var(--accent-color-1), var(--accent-color-2), var(--accent-color-1));
            background-size: 200% auto;
            color: #1a2e05;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(.25,.8,.25,1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            background-position: right center;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(132, 204, 22, 0.2), 0 4px 6px -4px rgba(132, 204, 22, 0.1);
        }

        /* Profile Tab styles with smooth transitions */
        .profile-tab {
            border-bottom: 2px solid transparent;
            transition: all var(--theme-transition-duration) var(--theme-transition-easing),
                        border-color 0.3s ease,
                        background-color 0.3s ease;
        }
        .profile-tab.active {
            border-bottom-color: var(--accent-color-1);
            color: var(--text-light);
        }
        html.dark .profile-tab.active {
            color: var(--text-dark);
        }

        /* Smooth transitions for all interactive elements */
        button, a, input, select, textarea {
            transition: all 0.3s ease,
                        background-color var(--theme-transition-duration) var(--theme-transition-easing),
                        color var(--theme-transition-duration) var(--theme-transition-easing),
                        border-color var(--theme-transition-duration) var(--theme-transition-easing);
        }

        /* Navigation menu items smooth transitions */
        .nav-menu-item {
            position: relative;
            transition: background-color 0.3s ease,
                        transform 0.2s ease,
                        box-shadow 0.3s ease,
                        border-left 0.3s ease;
        }
        
        /* Hover effect for nav items */
        .nav-menu-item:hover:not(.active) {
            transform: translateX(4px);
            background-color: rgba(132, 204, 22, 0.05);
        }
        
        html.dark .nav-menu-item:hover:not(.active) {
            background-color: rgba(190, 242, 100, 0.08);
        }
        
        /* Enhanced active state for nav menu items - Light Mode with vibrant effects */
        .nav-menu-item.active {
            background: linear-gradient(to right, rgba(132, 204, 22, 0.25), rgba(132, 204, 22, 0.08));
            border-left: 4px solid #84cc16; /* lime-500 border */
            box-shadow: inset 0 0 20px rgba(132, 204, 22, 0.15),
                        0 2px 8px rgba(132, 204, 22, 0.2);
        }
        
        .nav-menu-item.active > span {
            color: #4d7c0f; /* lime-700 - deep vibrant green for excellent contrast */
            font-weight: 700; /* bolder text */
            text-shadow: 0 1px 2px rgba(132, 204, 22, 0.1);
            transition: color 0.3s ease;
        }
        
        .nav-menu-item.active > div {
            background: linear-gradient(135deg, rgba(132, 204, 22, 0.3), rgba(163, 230, 53, 0.25)) !important;
            border: 2px solid rgba(132, 204, 22, 0.4);
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(132, 204, 22, 0.25),
                        inset 0 2px 4px rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        .nav-menu-item.active i {
            color: #4d7c0f !important; /* lime-700 - deep vibrant green */
            font-weight: 700;
            filter: drop-shadow(0 2px 4px rgba(132, 204, 22, 0.3));
            transition: color 0.3s ease, transform 0.3s ease;
            transform: scale(1.2); /* larger icon for emphasis */
        }
        
        /* Enhanced dark mode active state - Better green visibility with matching effects */
        html.dark .nav-menu-item.active {
            background: linear-gradient(to right, rgba(190, 242, 100, 0.25), rgba(190, 242, 100, 0.10));
            border-left: 4px solid #bef264; /* lime-300 - brighter border for dark mode */
            box-shadow: inset 0 0 20px rgba(190, 242, 100, 0.2),
                        0 2px 8px rgba(190, 242, 100, 0.25);
        }
        
        html.dark .nav-menu-item.active > span {
            color: #bef264; /* lime-300 - excellent contrast in dark mode */
            font-weight: 700;
            text-shadow: 0 1px 4px rgba(190, 242, 100, 0.4);
        }
        
        html.dark .nav-menu-item.active > div {
            background: linear-gradient(135deg, rgba(190, 242, 100, 0.3), rgba(217, 249, 157, 0.25)) !important;
            border: 2px solid rgba(190, 242, 100, 0.5);
            box-shadow: 0 4px 12px rgba(190, 242, 100, 0.3),
                        inset 0 2px 4px rgba(190, 242, 100, 0.2);
        }
        
        html.dark .nav-menu-item.active i {
            color: #d9f99d !important; /* lime-200 - even brighter for icons */
            font-weight: 700;
            filter: drop-shadow(0 2px 4px rgba(190, 242, 100, 0.5));
            transform: scale(1.2);
        }

        /* Icon transitions */
        i {
            transition: color var(--theme-transition-duration) var(--theme-transition-easing),
                        transform 0.3s ease;
        }

        /* Theme toggle button - subtle, no highlight effects */
        #theme-toggle {
            transition: opacity 0.2s ease;
        }
        #theme-toggle:hover {
            opacity: 0.8;
        }
        #theme-toggle:focus {
            outline: none;
        }

        /* Card hover effects with smooth transitions */
        .themed-card-bg:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
        }
        
        html.dark .themed-card-bg:hover {
            box-shadow: 0 12px 24px -4px rgba(0, 0, 0, 0.5),
                        0 4px 12px rgba(190, 242, 100, 0.15);
        }

        /* Enhanced Avatar styling for dark mode */
        #profile-avatar {
            transition: transform 0.3s ease,
                        box-shadow 0.3s ease,
                        border-color var(--theme-transition-duration) var(--theme-transition-easing);
        }
        #profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(132, 204, 22, 0.3);
        }
        
        html.dark #profile-avatar {
            border-color: #bef264;
            box-shadow: 0 0 20px rgba(190, 242, 100, 0.3);
        }
        
        html.dark #profile-avatar:hover {
            box-shadow: 0 0 30px rgba(190, 242, 100, 0.5),
                        0 8px 16px rgba(190, 242, 100, 0.3);
        }

        /* Enhanced profile name in dark mode */
        html.dark #profile-name {
            color: #ecfccb;
            text-shadow: 0 2px 8px rgba(190, 242, 100, 0.2);
        }

        /* Badge styling enhancement for dark mode */
        .px-3.py-1.rounded-full {
            transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
                        color var(--theme-transition-duration) var(--theme-transition-easing),
                        box-shadow 0.3s ease;
        }
        
        html.dark .bg-purple-100 {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.25), rgba(147, 51, 234, 0.2)) !important;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3),
                        inset 0 2px 4px rgba(168, 85, 247, 0.2);
        }

        /* Membership info card enhancement */
        html.dark .bg-gradient-to-r.from-lime-50 {
            background: linear-gradient(to right, rgba(190, 242, 100, 0.15), rgba(134, 239, 172, 0.15)) !important;
            border: 1px solid rgba(190, 242, 100, 0.3);
            box-shadow: inset 0 2px 8px rgba(190, 242, 100, 0.1);
        }

        /* Wallet section enhancement */
        html.dark .bg-purple-100.dark\:bg-purple-900 {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.25), rgba(147, 51, 234, 0.2)) !important;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
        }

        /* Free cash banner enhancement */
        html.dark .bg-gradient-to-r.from-purple-50 {
            background: linear-gradient(to right, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.2)) !important;
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.25);
        }

        /* Modal transitions */
        .fixed.inset-0 {
            transition: opacity 0.3s ease,
                        background-color var(--theme-transition-duration) var(--theme-transition-easing);
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }
        
        /* Enhanced header title in dark mode */
        html.dark h1 {
            color: #ecfccb;
            text-shadow: 0 2px 8px rgba(190, 242, 100, 0.2);
        }
        
        /* Enhanced back button in dark mode */
        html.dark .ph-arrow-left {
            filter: drop-shadow(0 2px 4px rgba(190, 242, 100, 0.4));
        }

        /* Order cards smooth transitions with enhanced dark mode */
        .themed-bg.border.themed-border.rounded-lg {
            transition: transform 0.2s ease,
                        box-shadow 0.3s ease,
                        background-color var(--theme-transition-duration) var(--theme-transition-easing),
                        border-color var(--theme-transition-duration) var(--theme-transition-easing);
        }
        
        html.dark .themed-bg.border.themed-border.rounded-lg:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4),
                        0 2px 8px rgba(190, 242, 100, 0.2);
            border-color: rgba(190, 242, 100, 0.3);
        }
        
        /* Enhanced button styling in dark mode */
        html.dark .btn-primary {
            box-shadow: 0 4px 12px rgba(132, 204, 22, 0.4),
                        0 2px 6px rgba(163, 230, 53, 0.3);
        }
        
        html.dark .btn-primary:hover {
            box-shadow: 0 8px 20px rgba(132, 204, 22, 0.5),
                        0 4px 12px rgba(163, 230, 53, 0.4);
        }
        
        /* Enhanced input fields in dark mode */
        html.dark input[type="text"],
        html.dark input[type="email"],
        html.dark input[type="tel"],
        html.dark textarea,
        html.dark select {
            background-color: rgba(30, 41, 59, 0.8);
            border-color: rgba(190, 242, 100, 0.2);
            color: #ecfccb;
        }
        
        html.dark input:focus,
        html.dark textarea:focus,
        html.dark select:focus {
            border-color: #bef264;
            box-shadow: 0 0 0 3px rgba(190, 242, 100, 0.2),
                        0 4px 12px rgba(190, 242, 100, 0.3);
            outline: none;
        }
        
        /* Enhanced text colors in dark mode */
        html.dark h2,
        html.dark h3 {
            color: #ecfccb;
            text-shadow: 0 1px 4px rgba(190, 242, 100, 0.15);
        }
        
        /* Logout button enhancement in dark mode */
        html.dark #logout-btn {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1));
            border-color: rgba(248, 113, 113, 0.3);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        html.dark #logout-btn:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.25), rgba(220, 38, 38, 0.2));
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        /* ============================================ */
        /* MOBILE RESPONSIVE ENHANCEMENTS */
        /* ============================================ */
        
        /* Mobile: Small devices (phones, 640px and down) */
        @media (max-width: 640px) {
            /* Reduce padding and margins for mobile */
            body {
                padding-bottom: 80px;
            }
            
            /* Header adjustments */
            header h1 {
                font-size: 1.5rem !important;
            }
            
            /* Profile avatar smaller on mobile */
            #profile-avatar {
                width: 64px !important;
                height: 64px !important;
            }
            
            html.dark #profile-avatar {
                box-shadow: 0 0 15px rgba(190, 242, 100, 0.25);
            }
            
            /* Reduce card padding on mobile */
            .themed-card-bg {
                padding: 1rem !important;
            }
            
            /* Mobile nav menu items - reduce padding */
            .nav-menu-item {
                padding: 0.75rem !important;
                font-size: 0.9rem;
            }
            
            .nav-menu-item > div {
                width: 36px !important;
                height: 36px !important;
            }
            
            .nav-menu-item i {
                font-size: 1.25rem !important;
            }
            
            /* Active nav items - reduced effects on mobile */
            .nav-menu-item.active {
                background: linear-gradient(to right, rgba(132, 204, 22, 0.2), rgba(132, 204, 22, 0.06));
                border-left-width: 3px;
            }
            
            html.dark .nav-menu-item.active {
                background: linear-gradient(to right, rgba(190, 242, 100, 0.2), rgba(190, 242, 100, 0.08));
            }
            
            /* Mobile button sizing */
            .btn-primary {
                padding: 0.75rem 1.5rem !important;
                font-size: 0.9rem;
            }
            
            /* Mobile theme toggle */
            #theme-toggle i {
                font-size: 1.75rem !important;
            }
            
            /* Reduce shadow effects on mobile for performance */
            html.dark .themed-card-bg:hover {
                box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.4),
                            0 2px 6px rgba(190, 242, 100, 0.1);
            }
            
            /* Mobile input fields */
            input, textarea, select {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
            
            html.dark input:focus,
            html.dark textarea:focus,
            html.dark select:focus {
                box-shadow: 0 0 0 2px rgba(190, 242, 100, 0.15),
                            0 2px 8px rgba(190, 242, 100, 0.2);
            }
            
            /* Mobile glass effect - reduce blur for performance */
            .glass-effect {
                -webkit-backdrop-filter: blur(10px) saturate(150%);
                backdrop-filter: blur(10px) saturate(150%);
            }
            
            html.dark .glass-effect {
                -webkit-backdrop-filter: blur(12px) saturate(150%);
                backdrop-filter: blur(12px) saturate(150%);
            }
            
            /* Mobile gradient animation - slower for battery */
            @keyframes gradientShift {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            html.dark body {
                animation: gradientShift 20s ease infinite; /* Slower on mobile */
            }
            
            /* Mobile hover states - tap friendly */
            .nav-menu-item:hover:not(.active) {
                transform: translateX(2px); /* Reduced movement */
            }
            
            /* Mobile badges */
            .px-3.py-1.rounded-full {
                font-size: 0.75rem;
                padding: 0.25rem 0.75rem !important;
            }
        }
        
        /* Mobile: Extra small devices (320px and down) */
        @media (max-width: 380px) {
            header h1 {
                font-size: 1.25rem !important;
            }
            
            #profile-avatar {
                width: 56px !important;
                height: 56px !important;
            }
            
            .nav-menu-item {
                padding: 0.625rem !important;
                font-size: 0.85rem;
            }
            
            .nav-menu-item > div {
                width: 32px !important;
                height: 32px !important;
            }
            
            /* Further reduce effects on very small screens */
            html.dark #profile-avatar {
                box-shadow: 0 0 10px rgba(190, 242, 100, 0.2);
            }
            
            .nav-menu-item.active > div {
                transform: scale(1.03); /* Reduced scale */
            }
            
            .nav-menu-item.active i {
                transform: scale(1.1); /* Reduced scale */
            }
        }
        
        /* Tablet: Medium devices (641px to 1024px) */
        @media (min-width: 641px) and (max-width: 1024px) {
            /* Optimize for tablets */
            .themed-card-bg {
                padding: 1.25rem;
            }
            
            .nav-menu-item {
                padding: 0.875rem 1rem;
            }
            
            /* Tablet-optimized effects */
            html.dark .themed-card-bg:hover {
                box-shadow: 0 10px 20px -4px rgba(0, 0, 0, 0.45),
                            0 3px 10px rgba(190, 242, 100, 0.12);
            }
            
            /* Tablet glass effect */
            .glass-effect {
                -webkit-backdrop-filter: blur(14px) saturate(170%);
                backdrop-filter: blur(14px) saturate(170%);
            }
            
            html.dark .glass-effect {
                -webkit-backdrop-filter: blur(16px) saturate(170%);
                backdrop-filter: blur(16px) saturate(170%);
            }
        }
        
        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            /* Remove hover effects on touch devices */
            .themed-card-bg:hover {
                transform: none;
            }
            
            .nav-menu-item:hover:not(.active) {
                transform: none;
                background-color: transparent;
            }
            
            /* Make tap targets larger */
            .nav-menu-item {
                min-height: 48px; /* Minimum touch target size */
            }
            
            button {
                min-height: 44px; /* iOS recommended size */
            }
            
            /* Enhance active states for touch */
            .nav-menu-item:active {
                opacity: 0.8;
            }
            
            html.dark .nav-menu-item:active {
                background: linear-gradient(to right, rgba(190, 242, 100, 0.3), rgba(190, 242, 100, 0.12));
            }
        }
        
        /* Landscape mobile optimizations */
        @media (max-width: 900px) and (orientation: landscape) {
            body {
                padding-bottom: 60px;
            }
            
            header {
                padding-top: 0.75rem !important;
                padding-bottom: 0.75rem !important;
            }
            
            .themed-card-bg {
                padding: 0.875rem !important;
            }
        }
        
        /* High DPI screens - sharper effects */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            /* Enhance visual quality on retina displays */
            html.dark #profile-avatar {
                box-shadow: 0 0 20px rgba(190, 242, 100, 0.35);
            }
            
            html.dark .nav-menu-item.active {
                box-shadow: inset 0 0 24px rgba(190, 242, 100, 0.22),
                            0 2px 10px rgba(190, 242, 100, 0.28);
            }
        }
        
        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            html.dark body {
                animation: none;
            }
            
            .nav-menu-item:hover:not(.active),
            .themed-card-bg:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <div class="container mx-auto max-w-6xl px-4 sm:px-6 py-8">
        <!-- Header -->
        <header class="sticky top-0 z-50 flex justify-between items-center mb-8 py-4 glass-effect -mx-4 sm:-mx-6 px-4 sm:px-6 rounded-lg">
            <div class="flex items-center gap-3">
                <button onclick="window.location.href='./index.html'" class="p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-all" title="Back to Home">
                    <i class="ph ph-arrow-left text-2xl text-[#1a2e05] dark:text-[#bef264]"></i>
                </button>
                <h1 class="text-2xl sm:text-3xl font-bold">My Profile</h1>
            </div>
            <button id="theme-toggle" class="p-2 rounded-lg transition-all" title="Toggle theme">
                <i id="sun-icon" class="ph ph-sun text-3xl text-[#84cc16]"></i>
                <i id="moon-icon" class="ph ph-moon text-3xl text-[#84cc16] hidden"></i>
            </button>
        </header>

        <!-- Sign In Prompt for Guest Users -->
        <div id="sign-in-prompt" class="themed-card-bg border themed-border rounded-xl shadow-lg mb-8 p-8 text-center hidden">
            <div class="max-w-md mx-auto">
                <div class="w-20 h-20 rounded-full bg-[color:var(--accent-color-1)] mx-auto mb-4 flex items-center justify-center">
                    <i class="ph ph-user-circle text-5xl text-[#1a2e05]"></i>
                </div>
                <h2 class="text-2xl font-bold mb-2">Sign in to Your Account</h2>
                <p class="themed-subtle-text mb-6">Sign in to access your profile, order history, and personalized recommendations.</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center mb-4">
                    <button id="clerk-sign-in-btn" class="btn-primary px-8 py-3 rounded-lg text-lg font-semibold">
                        <i class="ph ph-sign-in"></i> Sign In
                    </button>
                    <button id="clerk-sign-up-btn" class="themed-card-bg border-2 border-[color:var(--accent-color-1)] text-[color:var(--accent-color-1)] px-8 py-3 rounded-lg text-lg font-semibold hover:bg-[color:var(--accent-color-1)] hover:text-[#1a2e05] transition-colors">
                        <i class="ph ph-user-plus"></i> Sign Up
                    </button>
                </div>
                <p class="text-sm themed-subtle-text">New to GroceryMart? Create an account to get started!</p>
            </div>
        </div>

        <!-- Main Profile Layout -->
        <div id="profile-content" class="grid md:grid-cols-[400px_1fr] gap-6">
            <!-- Left Sidebar -->
            <div class="space-y-4">
                <!-- Profile Card -->
                <div class="themed-card-bg border themed-border rounded-xl shadow-lg p-6">
                    <div class="flex items-start gap-4 mb-6">
                        <img id="profile-avatar" src="https://placehold.co/80x80/a3e635/1a2e05?text=G" alt="User Avatar" class="w-20 h-20 rounded-full border-2 border-[color:var(--accent-color-1)]">
                        <div class="flex-1">
                            <h2 id="profile-name" class="text-xl font-bold themed-text">Niraj</h2>
                            <p id="profile-member-id" class="text-sm themed-subtle-text">7076003050</p>
                            <span class="inline-block mt-2 px-3 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs font-semibold rounded-full">
                                <i class="ph ph-crown"></i> daily member
                            </span>
                        </div>
                    </div>

                    <!-- Membership Info -->
                    <div class="bg-gradient-to-r from-lime-50 to-green-50 dark:from-lime-900/20 dark:to-green-900/20 rounded-lg p-4 mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm themed-subtle-text">Valid till</span>
                            <span class="font-bold text-lg">30 Oct</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm themed-subtle-text">Saved</span>
                            <span class="font-bold text-lg text-green-600">‚Çπ<span id="saved-money">392</span></span>
                        </div>
                    </div>

                    <!-- Wallet Section -->
                    <div class="themed-bg border themed-border rounded-lg p-4 mb-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                                <i class="ph ph-wallet text-purple-600 dark:text-purple-400 text-xl"></i>
                            </div>
                            <span class="font-medium themed-text">Wallet</span>
                        </div>
                        <i class="ph ph-caret-right themed-subtle-text"></i>
                    </div>

                    <!-- Balance Section -->
                    <div class="border-t themed-border pt-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-sm themed-subtle-text">Available Balance:</span>
                            <span class="font-bold">‚Çπ0</span>
                        </div>
                        <button class="w-full btn-primary py-2 rounded-lg text-sm font-semibold">
                            Add Balance
                        </button>
                    </div>

                    <!-- Free Cash Banner -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-3 mt-4 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <i class="ph ph-gift text-purple-600 dark:text-purple-400"></i>
                            <span class="text-sm font-medium">Free Cash</span>
                        </div>
                        <span class="font-bold text-purple-600 dark:text-purple-400">‚Çπ100</span>
                    </div>
                </div>

                <!-- Navigation Menu -->
                <div class="themed-card-bg border themed-border rounded-xl shadow-lg overflow-hidden">
                    <button data-section="orders" class="nav-menu-item w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors border-b themed-border">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                            <i class="ph ph-shopping-bag text-xl"></i>
                        </div>
                        <span class="font-medium">Orders</span>
                    </button>
                    <button data-section="support" class="nav-menu-item w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors border-b themed-border">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                            <i class="ph ph-headset text-xl"></i>
                        </div>
                        <span class="font-medium">Customer Support</span>
                    </button>
                    <button data-section="referrals" class="nav-menu-item w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors border-b themed-border">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                            <i class="ph ph-users text-xl"></i>
                        </div>
                        <span class="font-medium">Manage Referrals</span>
                    </button>
                    <button data-section="addresses" class="nav-menu-item w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors border-b themed-border">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                            <i class="ph ph-map-pin text-xl"></i>
                        </div>
                        <span class="font-medium">Addresses</span>
                    </button>
                    <button id="edit-profile-btn" data-section="profile" class="nav-menu-item w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                            <i class="ph ph-user text-xl"></i>
                        </div>
                        <span class="font-medium">Profile</span>
                    </button>
                </div>

                <!-- Logout Button -->
                <button id="logout-btn" class="w-full themed-card-bg border themed-border rounded-xl shadow-lg p-4 font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors flex items-center justify-center gap-2">
                    <i class="ph ph-sign-out"></i>
                    Logout
                </button>
            </div>

            <!-- Right Content Area -->
            <div class="themed-card-bg border themed-border rounded-xl shadow-lg">
                <!-- Orders Section (Default) -->
                <div id="orders-section" class="content-section">
                    <div class="p-6 border-b themed-border flex items-center justify-between">
                        <h2 class="text-2xl font-bold flex items-center gap-3">
                            <button class="p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors md:hidden">
                                <i class="ph ph-arrow-left"></i>
                            </button>
                            Orders
                        </h2>
                        <select class="themed-bg border themed-border rounded-lg px-4 py-2 text-sm">
                            <option>All Orders</option>
                            <option>Last 30 days</option>
                            <option>Last 6 months</option>
                        </select>
                    </div>
                    <div id="order-history-container" class="p-6 space-y-4">
                        <!-- Orders will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Other Sections (Hidden by default) -->
                <div id="support-section" class="content-section hidden">
                    <div class="p-6 border-b themed-border">
                        <h2 class="text-2xl font-bold">Customer Support</h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <!-- Contact Options -->
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="themed-bg border themed-border rounded-lg p-4 cursor-pointer hover:shadow-md transition-all">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                                        <i class="ph ph-phone text-blue-600 dark:text-blue-400 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold themed-text">Call Us</h4>
                                        <p class="text-sm themed-subtle-text">24/7 Support</p>
                                    </div>
                                </div>
                                <p class="font-semibold text-lg">1800-123-4567</p>
                            </div>

                            <div class="themed-bg border themed-border rounded-lg p-4 cursor-pointer hover:shadow-md transition-all">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
                                        <i class="ph ph-whatsapp-logo text-green-600 dark:text-green-400 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold themed-text">WhatsApp</h4>
                                        <p class="text-sm themed-subtle-text">Chat with us</p>
                                    </div>
                                </div>
                                <p class="font-semibold text-lg">+91 98765 43210</p>
                            </div>

                            <div class="themed-bg border themed-border rounded-lg p-4 cursor-pointer hover:shadow-md transition-all">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-12 h-12 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center">
                                        <i class="ph ph-envelope text-red-600 dark:text-red-400 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold themed-text">Email</h4>
                                        <p class="text-sm themed-subtle-text">We'll reply in 24hrs</p>
                                    </div>
                                </div>
                                <p class="font-semibold text-lg">support@grocerymart.com</p>
                            </div>

                            <div class="themed-bg border themed-border rounded-lg p-4 cursor-pointer hover:shadow-md transition-all">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center">
                                        <i class="ph ph-chat-circle-dots text-purple-600 dark:text-purple-400 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold themed-text">Live Chat</h4>
                                        <p class="text-sm themed-subtle-text">Instant support</p>
                                    </div>
                                </div>
                                <p class="font-semibold text-lg">Start Chat</p>
                            </div>
                        </div>

                        <!-- FAQ Section -->
                        <div class="themed-bg border themed-border rounded-lg p-6">
                            <h3 class="font-bold text-lg mb-4">Frequently Asked Questions</h3>
                            <div class="space-y-3">
                                <details class="themed-bg border themed-border rounded-lg p-4">
                                    <summary class="font-medium cursor-pointer">How do I track my order?</summary>
                                    <p class="mt-2 text-sm themed-subtle-text">You can track your order in the Orders section. Click on any order to see real-time tracking updates.</p>
                                </details>
                                <details class="themed-bg border themed-border rounded-lg p-4">
                                    <summary class="font-medium cursor-pointer">What is the refund policy?</summary>
                                    <p class="mt-2 text-sm themed-subtle-text">Full refunds are available within 24 hours of delivery for damaged or incorrect items. Contact support to initiate a refund.</p>
                                </details>
                                <details class="themed-bg border themed-border rounded-lg p-4">
                                    <summary class="font-medium cursor-pointer">How do I change my delivery address?</summary>
                                    <p class="mt-2 text-sm themed-subtle-text">Go to the Addresses section and add or edit your saved addresses. You can select a different address during checkout.</p>
                                </details>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="referrals-section" class="content-section hidden">
                    <div class="p-6 border-b themed-border">
                        <h2 class="text-2xl font-bold">Manage Referrals</h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <!-- Referral Card -->
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border themed-border rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-2xl font-bold mb-2">Refer & Earn ‚Çπ100</h3>
                                    <p class="themed-subtle-text">Share your referral code with friends</p>
                                </div>
                                <div class="text-5xl">üéÅ</div>
                            </div>
                            
                            <div class="bg-white dark:bg-slate-800 border themed-border rounded-lg p-4 mb-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm themed-subtle-text mb-1">Your Referral Code</p>
                                        <p class="text-2xl font-bold font-mono">NIRAJ2025</p>
                                    </div>
                                    <button id="copy-referral-btn" class="btn-primary px-4 py-2 rounded-lg">
                                        <i class="ph ph-copy"></i> Copy
                                    </button>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <button class="themed-bg border themed-border px-4 py-2 rounded-lg font-medium hover:shadow-md transition-all">
                                    <i class="ph ph-whatsapp-logo"></i> Share on WhatsApp
                                </button>
                                <button class="themed-bg border themed-border px-4 py-2 rounded-lg font-medium hover:shadow-md transition-all">
                                    <i class="ph ph-share-network"></i> More Options
                                </button>
                            </div>
                        </div>

                        <!-- Referral Stats -->
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="themed-bg border themed-border rounded-lg p-4">
                                <p class="text-sm themed-subtle-text mb-1">Total Referrals</p>
                                <p class="text-3xl font-bold">5</p>
                            </div>
                            <div class="themed-bg border themed-border rounded-lg p-4">
                                <p class="text-sm themed-subtle-text mb-1">Successful</p>
                                <p class="text-3xl font-bold text-green-600">3</p>
                            </div>
                            <div class="themed-bg border themed-border rounded-lg p-4">
                                <p class="text-sm themed-subtle-text mb-1">Earnings</p>
                                <p class="text-3xl font-bold text-purple-600">‚Çπ300</p>
                            </div>
                        </div>

                        <!-- Referral History -->
                        <div class="themed-bg border themed-border rounded-lg p-6">
                            <h3 class="font-bold text-lg mb-4">Referral History</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between py-3 border-b themed-border">
                                    <div>
                                        <p class="font-medium">Rahul Kumar</p>
                                        <p class="text-sm themed-subtle-text">Joined on Oct 15, 2025</p>
                                    </div>
                                    <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300 text-xs font-semibold rounded-full">
                                        +‚Çπ100
                                    </span>
                                </div>
                                <div class="flex items-center justify-between py-3 border-b themed-border">
                                    <div>
                                        <p class="font-medium">Priya Sharma</p>
                                        <p class="text-sm themed-subtle-text">Joined on Oct 10, 2025</p>
                                    </div>
                                    <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300 text-xs font-semibold rounded-full">
                                        +‚Çπ100
                                    </span>
                                </div>
                                <div class="flex items-center justify-between py-3">
                                    <div>
                                        <p class="font-medium">Amit Patel</p>
                                        <p class="text-sm themed-subtle-text">Joined on Oct 5, 2025</p>
                                    </div>
                                    <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300 text-xs font-semibold rounded-full">
                                        +‚Çπ100
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="addresses-section" class="content-section hidden">
                    <div class="p-6 border-b themed-border flex items-center justify-between">
                        <h2 class="text-2xl font-bold">Saved Addresses</h2>
                        <button id="add-address-btn" class="btn-primary px-4 py-2 rounded-lg">
                            <i class="ph ph-plus"></i> Add New Address
                        </button>
                    </div>
                    <div id="addresses-container" class="p-6 space-y-4">
                        <!-- Addresses will be dynamically inserted here -->
                    </div>
                </div>

                <div id="profile-section" class="content-section hidden">
                    <div class="p-6 border-b themed-border">
                        <h2 class="text-2xl font-bold">Profile Settings</h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <!-- Personal Information -->
                        <div class="themed-bg border themed-border rounded-lg p-6">
                            <h3 class="font-bold text-lg mb-4">Personal Information</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm themed-subtle-text font-medium">Full Name</label>
                                    <p id="profile-name-display" class="font-semibold text-lg mt-1">Niraj</p>
                                </div>
                                <div>
                                    <label class="text-sm themed-subtle-text font-medium">Email</label>
                                    <p id="profile-email-display" class="font-semibold text-lg mt-1">guest.user@email.com</p>
                                </div>
                                <div>
                                    <label class="text-sm themed-subtle-text font-medium">Member ID</label>
                                    <p id="profile-member-id-display" class="font-semibold text-lg mt-1">7076003050</p>
                                </div>
                                <button id="open-edit-modal-btn" class="btn-primary px-6 py-2 rounded-lg mt-4">
                                    <i class="ph ph-pencil-simple"></i> Edit Profile
                                </button>
                            </div>
                        </div>

                        <!-- Account Settings -->
                        <div class="themed-bg border themed-border rounded-lg p-6">
                            <h3 class="font-bold text-lg mb-4">Preferences</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">Order Notifications</p>
                                        <p class="text-sm themed-subtle-text">Get updates about your orders</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="order-notifications" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-lime-300 dark:peer-focus:ring-lime-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[color:var(--accent-color-1)]"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium">Promotional Emails</p>
                                        <p class="text-sm themed-subtle-text">Receive offers and deals</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="promo-notifications" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-lime-300 dark:peer-focus:ring-lime-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[color:var(--accent-color-1)]"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Danger Zone -->
                        <div class="themed-bg border border-red-200 dark:border-red-900 rounded-lg p-6">
                            <h3 class="font-bold text-lg mb-4 text-red-600 dark:text-red-400">Danger Zone</h3>
                            <button class="w-full px-4 py-3 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-colors">
                                <i class="ph ph-trash"></i> Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div id="edit-profile-modal" class="fixed inset-0 glass-effect z-50 p-4 items-center justify-center hidden">
            <div class="w-full max-w-md themed-card-bg border themed-border rounded-xl p-6 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Edit Profile</h2>
                    <button id="close-edit-modal" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-all">
                        <i class="ph ph-x text-2xl"></i>
                    </button>
                </div>

                <form id="edit-profile-form" class="space-y-4">
                    <div>
                        <label for="edit-name" class="block text-sm font-medium themed-subtle-text mb-2">Full Name</label>
                        <input type="text" id="edit-name" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white">
                    </div>

                    <div>
                        <label for="edit-email" class="block text-sm font-medium themed-subtle-text mb-2">Email</label>
                        <input type="email" id="edit-email" placeholder="user@example.com" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white">
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button type="button" id="cancel-edit" class="flex-1 themed-card-bg border themed-border font-bold py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 btn-primary py-3 rounded-lg">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Address Modal -->
        <div id="add-address-modal" class="fixed inset-0 glass-effect z-50 p-4 items-center justify-center hidden">
            <div class="w-full max-w-md themed-card-bg border themed-border rounded-xl p-6 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Add New Address</h2>
                    <button id="close-address-modal" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-all">
                        <i class="ph ph-x text-2xl"></i>
                    </button>
                </div>

                <form id="add-address-form" class="space-y-4">
                    <div>
                        <label for="address-label" class="block text-sm font-medium themed-subtle-text mb-2">Label</label>
                        <select id="address-label" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white">
                            <option>Home</option>
                            <option>Work</option>
                            <option>Other</option>
                        </select>
                    </div>

                    <div>
                        <label for="address-line1" class="block text-sm font-medium themed-subtle-text mb-2">Address Line 1</label>
                        <input type="text" id="address-line1" placeholder="House/Flat No., Building Name" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white" required>
                    </div>

                    <div>
                        <label for="address-line2" class="block text-sm font-medium themed-subtle-text mb-2">Address Line 2</label>
                        <input type="text" id="address-line2" placeholder="Street, Area, Landmark" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white" required>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label for="address-city" class="block text-sm font-medium themed-subtle-text mb-2">City</label>
                            <input type="text" id="address-city" placeholder="Mumbai" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white" required>
                        </div>
                        <div>
                            <label for="address-pincode" class="block text-sm font-medium themed-subtle-text mb-2">Pincode</label>
                            <input type="text" id="address-pincode" placeholder="400001" maxlength="6" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white" required>
                        </div>
                    </div>

                    <div>
                        <label for="address-phone" class="block text-sm font-medium themed-subtle-text mb-2">Contact Number</label>
                        <input type="tel" id="address-phone" placeholder="+91 98765 43210" class="w-full themed-bg border themed-border rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent-color-1)] text-gray-900 dark:text-white" required>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button type="button" id="cancel-address" class="flex-1 themed-card-bg border themed-border font-bold py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 btn-primary py-3 rounded-lg">
                            Save Address
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Clerk initialization
        let clerk;
        let currentUser = null;
        let isSignedIn = false;

        async function initializeClerk() {
            try {
                console.log('üîÑ Initializing Clerk on profile page...');
                
                // Get Clerk configuration from our API
                const configResponse = await fetch('/api/config');
                console.log('üì° Config response status:', configResponse.status);
                
                if (!configResponse.ok) {
                    throw new Error(`Config API failed: ${configResponse.status}`);
                }
                
                const config = await configResponse.json();
                console.log('‚öôÔ∏è Config received:', config);
                
                if (!config.CLERK_PUBLISHABLE_KEY) {
                    console.error('‚ùå No Clerk publishable key found in config');
                    showSignInPrompt();
                    return;
                }
                
                console.log('üîë Clerk key found:', config.CLERK_PUBLISHABLE_KEY.substring(0, 20) + '...');
                
                // Wait for Clerk to be available
                if (!window.Clerk) {
                    console.log('‚è≥ Waiting for Clerk to load...');
                    await new Promise(resolve => {
                        const checkClerk = () => {
                            if (window.Clerk) {
                                resolve();
                            } else {
                                setTimeout(checkClerk, 100);
                            }
                        };
                        checkClerk();
                    });
                }
                
                clerk = window.Clerk;
                console.log('üèóÔ∏è Loading Clerk with key...');
                
                await clerk.load({
                    publishableKey: config.CLERK_PUBLISHABLE_KEY
                });
                
                console.log('‚úÖ Clerk loaded successfully on profile page');

                if (clerk.user) {
                    currentUser = clerk.user;
                    isSignedIn = true;
                    loadUserProfile(); // Load user-specific profile
                    updateProfileUI();
                    showProfileContent();
                    loadOrderHistory(); // Load user-specific orders
                    console.log('üë§ User is signed in:', currentUser.firstName);
                } else {
                    console.log('üë§ User is not signed in, showing prompt');
                    showSignInPrompt();
                }

                // Listen for sign-in events
                clerk.addListener(({ user }) => {
                    if (user) {
                        currentUser = user;
                        isSignedIn = true;
                        loadUserProfile(); // Load user-specific profile
                        updateProfileUI();
                        showProfileContent();
                        loadOrderHistory(); // Load user-specific orders
                        console.log('üë§ User signed in on profile page:', user.firstName);
                    } else {
                        currentUser = null;
                        isSignedIn = false;
                        showSignInPrompt();
                        console.log('üë§ User signed out on profile page');
                    }
                });
            } catch (error) {
                console.error('‚ùå Clerk initialization error on profile page:', error);
                showSignInPrompt();
            }
        }

        // Show sign-in prompt
        function showSignInPrompt() {
            const signInPrompt = document.getElementById('sign-in-prompt');
            const profileContent = document.getElementById('profile-content');
            
            if (signInPrompt) signInPrompt.classList.remove('hidden');
            if (profileContent) profileContent.classList.add('hidden');
        }

        // Show profile content
        function showProfileContent() {
            const signInPrompt = document.getElementById('sign-in-prompt');
            const profileContent = document.getElementById('profile-content');
            
            if (signInPrompt) signInPrompt.classList.add('hidden');
            if (profileContent) profileContent.classList.remove('hidden');
        }

        // Clerk sign-in buttons
        const clerkSignInBtn = document.getElementById('clerk-sign-in-btn');
        const clerkSignUpBtn = document.getElementById('clerk-sign-up-btn');
        
        if (clerkSignInBtn) {
            clerkSignInBtn.addEventListener('click', async () => {
                console.log('üîê Sign In button clicked');
                if (clerk) {
                    try {
                        await clerk.openSignIn();
                    } catch (error) {
                        console.error('Error opening sign in:', error);
                    }
                } else {
                    console.error('‚ùå Clerk not initialized');
                    alert('Authentication system not ready. Please refresh the page.');
                }
            });
        }
        
        if (clerkSignUpBtn) {
            clerkSignUpBtn.addEventListener('click', async () => {
                console.log('üìù Sign Up button clicked');
                if (clerk) {
                    try {
                        await clerk.openSignUp();
                    } catch (error) {
                        console.error('Error opening sign up:', error);
                    }
                } else {
                    console.error('‚ùå Clerk not initialized');
                    alert('Authentication system not ready. Please refresh the page.');
                }
            });
        }

        // Get user-specific storage key for data isolation
        function getUserStorageKey(baseKey) {
            if (currentUser && currentUser.id) {
                return `${baseKey}_${currentUser.id}`;
            }
            return baseKey; // Guest users use non-specific key
        }

        // Profile data
        let userProfile = {
            name: 'Guest User',
            email: 'guest.user@email.com'
        };

        // Load user profile from localStorage or Clerk
        function loadUserProfile() {
            const profileKey = getUserStorageKey('grocerymartProfile');
            const savedProfile = localStorage.getItem(profileKey);
            
            if (currentUser) {
                // Authenticated user - use Clerk data as primary source
                userProfile = {
                    name: `${currentUser.firstName || ''} ${currentUser.lastName || ''}`.trim() || 'User',
                    email: currentUser.primaryEmailAddress?.emailAddress || currentUser.emailAddresses?.[0]?.emailAddress || 'user@email.com'
                };
                // Merge with saved preferences if they exist
                if (savedProfile) {
                    const parsed = JSON.parse(savedProfile);
                    userProfile = { ...userProfile, ...parsed };
                }
                // Save current profile
                localStorage.setItem(profileKey, JSON.stringify(userProfile));
            } else if (savedProfile) {
                // Guest user with saved profile
                userProfile = JSON.parse(savedProfile);
            }
        }

        // Initial load
        loadUserProfile();

        // Elements
        const profileAvatar = document.getElementById('profile-avatar');
        const profileName = document.getElementById('profile-name');
        const profileEmail = document.getElementById('profile-email');
        const profileEmailDisplay = document.getElementById('profile-email-display');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const openEditModalBtn = document.getElementById('open-edit-modal-btn');
        const editProfileModal = document.getElementById('edit-profile-modal');
        const closeEditModal = document.getElementById('close-edit-modal');
        const editProfileForm = document.getElementById('edit-profile-form');
        const cancelEdit = document.getElementById('cancel-edit');
        const logoutBtn = document.getElementById('logout-btn');
        const orderHistoryContainer = document.getElementById('order-history-container');

        // Theme toggle - simplified and smooth with consistent icon colors
        const themeToggleBtn = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const htmlEl = document.documentElement;

        const toggleTheme = () => {
            // Toggle dark mode immediately
            htmlEl.classList.toggle('dark');
            const isDarkMode = htmlEl.classList.contains('dark');
            
            // Simple instant icon swap
            if (isDarkMode) {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
            }
            
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        };

        // Initialize theme
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const isDarkMode = savedTheme === 'dark' || (!savedTheme && prefersDark);
        
        if (isDarkMode) {
            htmlEl.classList.add('dark');
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
        }
        
        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', toggleTheme);
        }

        // Tab switching
        const profileTabs = document.querySelectorAll('.profile-tab');
        const tabContents = document.querySelectorAll('.tab-content');

        profileTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                profileTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const tabName = tab.dataset.tab;
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName + '-tab').classList.remove('hidden');
            });
        });

        // Update profile UI with current user data
        function updateProfileUI() {
            // Reload profile data to ensure sync with Clerk
            if (currentUser) {
                loadUserProfile();
            }

            // Update all name displays
            const nameElements = [
                profileName, 
                document.getElementById('profile-name-display')
            ];
            nameElements.forEach(el => {
                if (el) el.textContent = userProfile.name || 'Guest User';
            });

            // Update all email displays
            const emailElements = [
                profileEmail, 
                profileEmailDisplay
            ];
            emailElements.forEach(el => {
                if (el) el.textContent = userProfile.email || 'guest@email.com';
            });

            // Update avatar with user initial
            const initial = (userProfile.name || 'G').charAt(0).toUpperCase();
            if (profileAvatar) {
                profileAvatar.src = `https://placehold.co/128x128/a3e635/1a2e05?text=${initial}`;
                profileAvatar.alt = `${userProfile.name} Avatar`;
            }

            // Update member ID display
            const memberIdDisplay = document.getElementById('profile-member-id-display');
            const memberId = document.getElementById('profile-member-id');
            const userId = currentUser?.id || 'GUEST';
            const displayId = userId.slice(0, 10).toUpperCase();
            
            if (memberIdDisplay) memberIdDisplay.textContent = displayId;
            if (memberId) memberId.textContent = displayId;
        }

        // Edit profile - modal opener
        if (openEditModalBtn) {
            openEditModalBtn.addEventListener('click', () => {
                document.getElementById('edit-name').value = userProfile.name;
                document.getElementById('edit-email').value = userProfile.email;
                editProfileModal.classList.remove('hidden');
                editProfileModal.classList.add('flex');
            });
        }

        closeEditModal.addEventListener('click', () => {
            editProfileModal.classList.add('hidden');
            editProfileModal.classList.remove('flex');
        });

        cancelEdit.addEventListener('click', () => {
            editProfileModal.classList.add('hidden');
            editProfileModal.classList.remove('flex');
        });

        editProfileForm.addEventListener('submit', (e) => {
            e.preventDefault();
            userProfile.name = document.getElementById('edit-name').value;
            userProfile.email = document.getElementById('edit-email').value;
            
            // Save with user-specific key
            const profileKey = getUserStorageKey('grocerymartProfile');
            localStorage.setItem(profileKey, JSON.stringify(userProfile));
            updateProfileUI();
            
            editProfileModal.classList.add('hidden');
            editProfileModal.classList.remove('flex');
        });

        // Load order history with user-specific data
        function loadOrderHistory() {
            const ordersKey = getUserStorageKey('grocerymartOrders');
            const savedOrders = localStorage.getItem(ordersKey);
            let orders = [];

            if (savedOrders) {
                try {
                    orders = JSON.parse(savedOrders);
                    
                    // Validate and fix order data
                    orders = orders.map(order => {
                        // Ensure items array exists
                        if (!order.items || !Array.isArray(order.items)) {
                            order.items = [];
                        }
                        
                        // Fix each item in the order
                        order.items = order.items.map(item => {
                            // Ensure all required fields exist
                            return {
                                name: item.name || 'Unknown Item',
                                unit: item.unit || 'piece',
                                price: parseFloat(item.price) || 50,
                                quantity: parseInt(item.quantity) || 1,
                                productId: item.productId || `reorder-${(item.name || 'item').replace(/\s+/g, '-').toLowerCase()}-${(item.unit || 'piece').replace(/\s+/g, '-').toLowerCase()}`,
                                image: item.image || 'üì¶'
                            };
                        });
                        
                        // Recalculate order total from items
                        order.total = order.items.reduce((sum, item) => {
                            return sum + (item.price * item.quantity);
                        }, 0);
                        
                        // Ensure other order fields
                        order.id = order.id || `GM${Math.floor(Math.random() * 10000)}`;
                        order.date = order.date || new Date().toISOString();
                        order.status = order.status || 'delivered';
                        
                        return order;
                    });
                    
                    // Save cleaned data back
                    localStorage.setItem(ordersKey, JSON.stringify(orders));
                } catch (error) {
                    console.error('Error parsing orders:', error);
                    orders = [];
                }
            }

            // Display orders or empty state
            if (orders.length === 0) {
                renderEmptyOrders();
                updateStats([]);
                return;
            }

            renderOrders(orders);
            updateStats(orders);
        }

        // Render empty orders state
        function renderEmptyOrders() {
            orderHistoryContainer.innerHTML = `
                <div class="text-center py-16">
                    <div class="text-7xl mb-4">ÔøΩ</div>
                    <h3 class="text-xl font-bold themed-text mb-2">No orders yet</h3>
                    <p class="themed-subtle-text mb-6">Start shopping to see your order history here!</p>
                    <a href="./index.html" class="inline-flex items-center gap-2 btn-primary px-6 py-3 rounded-lg font-semibold hover:scale-105 transition-transform">
                        <i class="ph ph-shopping-cart text-xl"></i>
                        Start Shopping
                    </a>
                </div>
            `;
        }

        // Render orders list
        function renderOrders(orders) {
            orderHistoryContainer.innerHTML = '';
            
            orders.forEach(order => {
                const orderElement = document.createElement('div');
                orderElement.className = 'themed-bg border themed-border rounded-lg p-4 hover:shadow-lg transition-all duration-200';
                
                // Generate items HTML
                const itemsHtml = order.items.map(item => `
                    <div class="flex items-center justify-between py-2 border-b themed-border last:border-b-0">
                        <div class="flex items-center gap-3 flex-1">
                            <span class="text-2xl">${item.image}</span>
                            <div class="flex-1">
                                <p class="font-medium text-sm themed-text">${item.name}</p>
                                <p class="text-xs themed-subtle-text">${item.unit} √ó ${item.quantity}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="font-semibold text-sm themed-text">‚Çπ${(item.price * item.quantity).toFixed(2)}</span>
                            <button class="reorder-item-btn bg-[color:var(--accent-color-1)] text-[#1a2e05] px-3 py-1 rounded-lg text-xs font-medium hover:bg-[color:var(--accent-color-2)] transition-colors" 
                                    data-item='${JSON.stringify(item)}'>
                                <i class="ph ph-shopping-cart"></i> Add
                            </button>
                        </div>
                    </div>
                `).join('');
                
                // Format date
                const orderDate = new Date(order.date);
                const formattedDate = orderDate.toLocaleDateString('en-IN', { 
                    day: 'numeric', 
                    month: 'short', 
                    year: 'numeric' 
                });
                
                // Status badge styling
                const statusClass = {
                    delivered: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300',
                    processing: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',
                    pending: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300',
                    cancelled: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300'
                }[order.status] || 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300';
                
                orderElement.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-[color:var(--accent-color-1)] flex items-center justify-center text-[#1a2e05] font-bold">
                                <i class="ph ph-shopping-bag text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold themed-text">Order #${order.id}</h4>
                                <p class="text-sm themed-subtle-text">
                                    <i class="ph ph-calendar-blank"></i> ${formattedDate}
                                </p>
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold capitalize ${statusClass}">
                            ${order.status}
                        </span>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="font-medium text-sm mb-2 themed-subtle-text">Items (${order.items.length}):</h5>
                        <div class="space-y-1">
                            ${itemsHtml}
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center pt-3 border-t themed-border">
                        <button class="reorder-all-btn text-[color:var(--accent-color-1)] hover:underline text-sm font-medium flex items-center gap-1" 
                                data-order='${JSON.stringify(order)}'>
                            <i class="ph ph-arrow-clockwise"></i> Reorder All
                        </button>
                        <p class="font-bold text-lg themed-text">‚Çπ${order.total.toFixed(2)}</p>
                    </div>
                `;
                
                orderHistoryContainer.appendChild(orderElement);
            });
        }

        // Update profile stats based on order history
        function updateStats(orders) {
            const totalOrders = orders.length;
            const totalSpent = orders.reduce((sum, order) => sum + (order.total || 0), 0);
            const avgOrder = totalOrders > 0 ? totalSpent / totalOrders : 0;
            const savedMoney = totalSpent * 0.12; // Estimated 12% savings from offers

            // Update stat displays
            const statsElements = {
                'total-orders': totalOrders,
                'total-spent': totalSpent.toFixed(2),
                'avg-order': avgOrder.toFixed(2),
                'saved-money': savedMoney.toFixed(2)
            };

            Object.entries(statsElements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        // Handle user logout
        logoutBtn.addEventListener('click', async () => {
            try {
                if (clerk && currentUser) {
                    await clerk.signOut();
                }
                
                // Clear current user data
                isSignedIn = false;
                currentUser = null;
                
                // Reset to guest profile
                userProfile = {
                    name: 'Guest User',
                    email: 'guest.user@email.com'
                };
                
                // Show notification
                showNotification('Logged out successfully', 'success');
                
                // Reload page to clear user-specific data
                setTimeout(() => location.reload(), 500);
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Logout failed. Please try again.', 'error');
            }
        });

        // Add item to cart (reorder functionality)
        function addToCart(item) {
            try {
                // Validate item
                if (!item || !item.name) {
                    showNotification('Invalid item data', 'error');
                    return;
                }
                
                // Get existing cart
                let cart = JSON.parse(localStorage.getItem('grocerymartCart') || '[]');
                
                // Ensure valid price
                const itemPrice = parseFloat(item.price) || 50;
                const quantity = parseInt(item.quantity) || 1;
                const unit = item.unit || 'piece';
                
                // Generate consistent product ID
                const productId = item.productId || 
                    `reorder-${item.name.replace(/\s+/g, '-').toLowerCase()}-${unit.replace(/\s+/g, '-').toLowerCase()}`;
                
                // Check if item already exists in cart
                const existingIndex = cart.findIndex(cartItem => 
                    cartItem.productId === productId && cartItem.unit === unit
                );
                
                if (existingIndex > -1) {
                    // Update existing item
                    cart[existingIndex].quantity += quantity;
                    cart[existingIndex].price = itemPrice;
                } else {
                    // Add new item to cart
                    cart.push({
                        productId: productId,
                        name: item.name,
                        unit: unit,
                        quantity: quantity,
                        price: itemPrice,
                        image: item.image || 'üõí'
                    });
                }
                
                // Save cart
                localStorage.setItem('grocerymartCart', JSON.stringify(cart));
                
                // Show success notification
                showNotification(`${item.name} added to cart!`, 'success');
                
            } catch (error) {
                console.error('Add to cart error:', error);
                showNotification('Failed to add item to cart', 'error');
            }
        }

        // Reorder all items from an order
        function reorderAllItems(order) {
            try {
                if (!order || !order.items || order.items.length === 0) {
                    showNotification('No items to reorder', 'warning');
                    return;
                }
                
                let itemCount = 0;
                order.items.forEach(item => {
                    addToCart(item);
                    itemCount++;
                });
                
                showNotification(`${itemCount} items from Order #${order.id} added to cart!`, 'success');
            } catch (error) {
                console.error('Reorder all error:', error);
                showNotification('Failed to reorder items', 'error');
            }
        }

        // Show notification message with animations
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            }[type] || 'bg-gray-500';
            
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg font-medium text-white shadow-lg transition-all transform translate-x-full ${bgColor}`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="ph ph-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : type === 'warning' ? 'warning-circle' : 'info'} text-xl"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Slide in
            requestAnimationFrame(() => {
                notification.classList.remove('translate-x-full');
            });
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Event delegation for reorder buttons
        document.addEventListener('click', (e) => {
            // Handle single item reorder
            const reorderItemBtn = e.target.closest('.reorder-item-btn');
            if (reorderItemBtn) {
                try {
                    const item = JSON.parse(reorderItemBtn.dataset.item);
                    addToCart(item);
                } catch (error) {
                    console.error('Reorder item error:', error);
                    showNotification('Failed to reorder item', 'error');
                }
            }
            
            // Handle reorder all items
            const reorderAllBtn = e.target.closest('.reorder-all-btn');
            if (reorderAllBtn) {
                try {
                    const order = JSON.parse(reorderAllBtn.dataset.order);
                    reorderAllItems(order);
                } catch (error) {
                    console.error('Reorder all error:', error);
                    showNotification('Failed to reorder items', 'error');
                }
            }
        });

        // Navigation between profile sections
        const navMenuItems = document.querySelectorAll('.nav-menu-item');
        const contentSections = document.querySelectorAll('.content-section');
        
        navMenuItems.forEach(item => {
            item.addEventListener('click', () => {
                const sectionName = item.dataset.section;
                
                if (!sectionName) return;
                
                // Hide all sections
                contentSections.forEach(section => section.classList.add('hidden'));
                
                // Show selected section
                const targetSection = document.getElementById(`${sectionName}-section`);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    
                    // Load section-specific data
                    switch(sectionName) {
                        case 'addresses':
                            loadAddresses();
                            break;
                        case 'orders':
                            loadOrderHistory();
                            break;
                    }
                }
                
                // Update active state - remove from all items
                navMenuItems.forEach(navItem => {
                    navItem.classList.remove('active');
                });
                
                // Add active state to clicked item
                item.classList.add('active');
            });
        });

        // Address Management
        let addresses = [];
        
        function loadAddresses() {
            const addressesKey = getUserStorageKey('grocerymartAddresses');
            const savedAddresses = localStorage.getItem(addressesKey);
            
            if (savedAddresses) {
                try {
                    addresses = JSON.parse(savedAddresses);
                } catch (error) {
                    console.error('Error loading addresses:', error);
                    addresses = [];
                }
            } else {
                addresses = [];
            }
            
            renderAddresses();
        }
        
        function renderAddresses() {
            const addressesContainer = document.getElementById('addresses-container');
            
            if (!addressesContainer) return;
            
            if (addresses.length === 0) {
                addressesContainer.innerHTML = `
                    <div class="text-center py-16">
                        <div class="text-7xl mb-4">üìç</div>
                        <h3 class="text-xl font-bold themed-text mb-2">No saved addresses</h3>
                        <p class="themed-subtle-text mb-4">Add your delivery address to get started</p>
                        <p class="text-xs themed-subtle-text">Click "Add New Address" button above</p>
                    </div>
                `;
                return;
            }
            
            addressesContainer.innerHTML = addresses.map(address => `
                <div class="themed-bg border themed-border rounded-lg p-4 hover:shadow-md transition-all">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-10 rounded-full bg-lime-100 dark:bg-lime-900 flex items-center justify-center">
                                <i class="ph ph-${address.label === 'Home' ? 'house' : address.label === 'Work' ? 'briefcase' : 'map-pin'} text-lime-600 dark:text-lime-400"></i>
                            </div>
                            <div>
                                <h4 class="font-bold themed-text">${address.label}</h4>
                                ${address.isDefault ? '<span class="text-xs px-2 py-1 bg-lime-100 dark:bg-lime-900 text-lime-800 dark:text-lime-300 rounded-full">Default</span>' : ''}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button class="edit-address-btn p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors" data-id="${address.id}">
                                <i class="ph ph-pencil"></i>
                            </button>
                            <button class="delete-address-btn p-2 hover:bg-red-100 dark:hover:bg-red-900 rounded-lg transition-colors text-red-600" data-id="${address.id}">
                                <i class="ph ph-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p class="text-sm themed-text mb-1">${address.line1}</p>
                    <p class="text-sm themed-text mb-1">${address.line2}</p>
                    <p class="text-sm themed-text mb-2">${address.city} - ${address.pincode}</p>
                    <p class="text-sm themed-subtle-text"><i class="ph ph-phone"></i> ${address.phone}</p>
                    ${!address.isDefault ? `
                        <button class="set-default-btn mt-3 text-sm text-lime-600 dark:text-lime-400 hover:underline" data-id="${address.id}">
                            Set as default
                        </button>
                    ` : ''}
                </div>
            `).join('');
            
            // Add event listeners
            document.querySelectorAll('.delete-address-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteAddress(parseInt(btn.dataset.id)));
            });
            
            document.querySelectorAll('.set-default-btn').forEach(btn => {
                btn.addEventListener('click', () => setDefaultAddress(parseInt(btn.dataset.id)));
            });
        }
        
        function deleteAddress(id) {
            if (confirm('Are you sure you want to delete this address?')) {
                addresses = addresses.filter(addr => addr.id !== id);
                const addressesKey = getUserStorageKey('grocerymartAddresses');
                localStorage.setItem(addressesKey, JSON.stringify(addresses));
                renderAddresses();
                showNotification('Address deleted successfully', 'success');
            }
        }
        
        function setDefaultAddress(id) {
            addresses = addresses.map(addr => ({
                ...addr,
                isDefault: addr.id === id
            }));
            const addressesKey = getUserStorageKey('grocerymartAddresses');
            localStorage.setItem(addressesKey, JSON.stringify(addresses));
            renderAddresses();
            showNotification('Default address updated', 'success');
        }

        // Address Modal
        const addAddressBtn = document.getElementById('add-address-btn');
        const addAddressModal = document.getElementById('add-address-modal');
        const closeAddressModal = document.getElementById('close-address-modal');
        const cancelAddress = document.getElementById('cancel-address');
        const addAddressForm = document.getElementById('add-address-form');
        
        addAddressBtn.addEventListener('click', () => {
            addAddressModal.classList.remove('hidden');
            addAddressModal.classList.add('flex');
        });
        
        closeAddressModal.addEventListener('click', () => {
            addAddressModal.classList.add('hidden');
            addAddressModal.classList.remove('flex');
        });
        
        cancelAddress.addEventListener('click', () => {
            addAddressModal.classList.add('hidden');
            addAddressModal.classList.remove('flex');
        });
        
        addAddressForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newAddress = {
                id: Date.now(),
                label: document.getElementById('address-label').value,
                line1: document.getElementById('address-line1').value,
                line2: document.getElementById('address-line2').value,
                city: document.getElementById('address-city').value,
                pincode: document.getElementById('address-pincode').value,
                phone: document.getElementById('address-phone').value,
                isDefault: addresses.length === 0
            };
            
            addresses.push(newAddress);
            const addressesKey = getUserStorageKey('grocerymartAddresses');
            localStorage.setItem(addressesKey, JSON.stringify(addresses));
            renderAddresses();
            
            addAddressForm.reset();
            addAddressModal.classList.add('hidden');
            addAddressModal.classList.remove('flex');
            
            showNotification('Address added successfully!', 'success');
        });

        // Copy Referral Code
        const copyReferralBtn = document.getElementById('copy-referral-btn');
        if (copyReferralBtn) {
            copyReferralBtn.addEventListener('click', () => {
                const referralCode = 'NIRAJ2025';
                navigator.clipboard.writeText(referralCode).then(() => {
                    showNotification('Referral code copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('Failed to copy referral code', 'error');
                });
            });
        }

        // Development helper function to reset order data (call from console: resetOrderData())
        window.resetOrderData = function() {
            localStorage.removeItem('grocerymartOrders');
            loadOrderHistory();
            showNotification('Order data has been reset with proper prices!', 'success');
        };

        // Initialize
        updateProfileUI();
        loadOrderHistory();
        initializeClerk();
        
        // Set default active menu item (Orders section)
        const defaultMenuItem = document.querySelector('.nav-menu-item[data-section="orders"]');
        if (defaultMenuItem) {
            defaultMenuItem.classList.add('active');
        }
    </script>
</body>
</html>
